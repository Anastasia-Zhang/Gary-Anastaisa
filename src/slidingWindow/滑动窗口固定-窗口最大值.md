### 滑动窗口：窗口值固定

#### 问题描述

给定一个整型数组arr和一个大小为w的窗口，窗口从数组最左边滑动到最右边，每次向右滑动一个位置，求出每一次滑动时窗口内最大元素的和。

```
 滑动窗口的位置                最大值
---------------               -----
[1  3  -1] -3  5  3  6  7       3
 1 [3  -1  -3] 5  3  6  7       3
 1  3 [-1  -3  5] 3  6  7       5
 1  3  -1 [-3  5  3] 6  7       5
 1  3  -1  -3 [5  3  6] 7       6
 1  3  -1  -3  5 [3  6  7]      7

```



#### 输入

输入第一行为用例个数， 每个测试用例输入的第一行为数组，每一个元素使用空格隔开；第二行为窗口大小。

##### 输出

输出每个测试用例结果。

![1574869550426](E:\研究生学习\Typora图片\1574869550426.png)

#### 算法思路

用双端队列记录窗口的最大值**下标**，双端队列的队头保存每个窗口的最大值，通过遍历每个数组，不断更新双端队列，使双端队列的队头元素始终是窗口的最大值。在遍历过程中用数组存储每个窗口的最大值，再求和。

##### 如何更新双端队列

要保证加入双端队列的所有元素都是窗口内最大值的候选

假设遍历到arr[i]

* 若双端队列为空：直接将数组加入
* 若双端队列不为空：取出队尾元素j
  * 若以队尾元素为下标的元素值大于arr[i] :直接将i加入队尾
  * 若以队列元素为下标的元素值小于等于arr[i] ：则出队列，再次循环判断 （移除当前队列里元素比要加入元素小的，因为他们不是最大的，这样才能保证当前加入队列的元素都是滑动窗口内最大值的候选元素）

##### 如何判断对头元素是否过期

当队头元素的下标小于当前遍历的i减去窗口大小+1时，队头元素过期去掉

##### 如何获得每个窗口的最大值

因为每次滑动一个位置，当i超过窗口的大小即不断将队头元素放入结果集中。

逻辑实现：

使用一层for循环遍历数组，

操作双端队列时只有一种情况需要循环，其他操作都一样。

#### 执行过程

```
1  3  -1 -3  5  3  6  7

-----添加新队列-----
1 
-----当前队尾元素小于等于要加入元素清空队列-----
清空：1 
-----添加新队列-----
3 
-----添加新队列-----
3 -1 
-----添加新队列-----
3 -1 -3 
-----当前队尾元素小于等于要加入元素清空队列-----
清空：-3 清空：-1 清空：3 
-----添加新队列-----
5 
-----添加新队列-----
5 3 
-----当前队尾元素小于等于要加入元素清空队列-----
清空：3 清空：5 
-----添加新队列-----
6 
-----当前队尾元素小于等于要加入元素清空队列-----
清空：6 
-----添加新队列-----
7 
```



#### 代码实现

```java
private static void getMaxWindow(int[] arr,int w){
    LinkedList<Integer> qmax = new LinkedList<>();
    int index = 0;
    int[] res = new int[arr.length - w + 1];
    for (int i = 0; i < arr.length;i ++){
        while(!qmax.isEmpty() && arr[qmax.peekLast()] <= arr[i]){
            qmax.pollLast();
        }
        qmax.addLast(i);
        if(qmax.peekFirst() < i - w + 1){
            qmax.pollFirst();
        }
        if(i >= w - 1){
            res[index++] = arr[qmax.peekFirst()];
        }
    }
    int sum = 0;
    for(int num : res){
        sum += num;
    }
    System.out.println(sum);
}
```

